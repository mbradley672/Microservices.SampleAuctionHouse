name: Deploy

on: [push]

jobs:
  upload:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1

    - name: Compress Repository
      uses: a7ul/tar-action@v1.1.3
      id: compress
      with: 
        command: c
        cwd: ./
        outPath: file.tar
        files: ./

    - name: Copy files to server
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.PASSWORD }}
        local-dir: "./"
        server-dir: "/var/www/bradleyshome.us/"
        secruity: loose
        protocol: ftps

    - name: Executing remote command
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.PASSWORD }}
        port: ${{ secrets.PORT }}
        script: | 
          cd /var/www/bradleyshome.us
          tar -xf file.tar
